!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ABTest=t()}(this,(function(){"use strict";function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function r(e,r){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,r){if(e){if("string"==typeof e)return t(e,r);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){a&&(e=a);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,d=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return c=e.done,e},e:function(e){d=!0,i=e},f:function(){try{c||null==a.return||a.return()}finally{if(d)throw i}}}}var a=100,n="abtest-uid-",o="abtest-trace-id-",i=31536e3;function c(e,t){if(!Array.isArray(t))throw new Error("config must be an array");return function(e,t){var n={};n[e]={launch_layer:{},layer:{}};var o,i=r(t);try{for(i.s();!(o=i.n()).done;){var c=o.value,h=c.hit,s=c.layer_id,u=void 0===s?"defaultLayerId":s,l=c.version,f=void 0===l?"":l,p=c.exp_set,A=c.ref_exp_data;n[e].layer[u]={ref_exp:{data:A,bucket:d(0,(100-100*h)/100*a),version:f},exp_set:{}};var v,x=0,C=r(p);try{for(C.s();!(v=C.n()).done;){var y=v.value,g=y.id,m=y.data,_=y.weight,w=_*a,b=d(x,w);n[e].layer[u].exp_set[g]={data:m,bucket:b,version:f},x=w,1===_&&(n[e].launch_layer[u]={data:m,id:g,version:f})}}catch(e){C.e(e)}finally{C.f()}}}catch(e){i.e(e)}finally{i.f()}return n[e]}(e,t)}function d(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,r=new Array(t),a=e,n=0;t--;)r[n]=a,a++,n++;return r}var h={exports:{}};!function(e,t){!function(r,a){var n={version:"3.0.1",x86:{},x64:{}};function o(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function i(e,t){return e<<t|e>>>32-t}function c(e){return e=o(e^=e>>>16,2246822507),e=o(e^=e>>>13,3266489909),e^=e>>>16}function d(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function h(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function s(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function u(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function l(e,t){return[e[0]^t[0],e[1]^t[1]]}function f(e){return e=l(e,[0,e[0]>>>1]),e=l(e=h(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=l(e=h(e,[3301882366,444984403]),[0,e[0]>>>1])}n.x86.hash32=function(e,t){t=t||0;for(var r=(e=e||"").length%4,a=e.length-r,n=t,d=0,h=3432918353,s=461845907,u=0;u<a;u+=4)d=o(d=255&e.charCodeAt(u)|(255&e.charCodeAt(u+1))<<8|(255&e.charCodeAt(u+2))<<16|(255&e.charCodeAt(u+3))<<24,h),d=o(d=i(d,15),s),n=o(n=i(n^=d,13),5)+3864292196;switch(d=0,r){case 3:d^=(255&e.charCodeAt(u+2))<<16;case 2:d^=(255&e.charCodeAt(u+1))<<8;case 1:d=o(d^=255&e.charCodeAt(u),h),n^=d=o(d=i(d,15),s)}return(n=c(n^=e.length))>>>0},n.x86.hash128=function(e,t){t=t||0;for(var r=(e=e||"").length%16,a=e.length-r,n=t,d=t,h=t,s=t,u=0,l=0,f=0,p=0,A=597399067,v=2869860233,x=951274213,C=2716044179,y=0;y<a;y+=16)u=255&e.charCodeAt(y)|(255&e.charCodeAt(y+1))<<8|(255&e.charCodeAt(y+2))<<16|(255&e.charCodeAt(y+3))<<24,l=255&e.charCodeAt(y+4)|(255&e.charCodeAt(y+5))<<8|(255&e.charCodeAt(y+6))<<16|(255&e.charCodeAt(y+7))<<24,f=255&e.charCodeAt(y+8)|(255&e.charCodeAt(y+9))<<8|(255&e.charCodeAt(y+10))<<16|(255&e.charCodeAt(y+11))<<24,p=255&e.charCodeAt(y+12)|(255&e.charCodeAt(y+13))<<8|(255&e.charCodeAt(y+14))<<16|(255&e.charCodeAt(y+15))<<24,u=i(u=o(u,A),15),n=i(n^=u=o(u,v),19),n=o(n+=d,5)+1444728091,l=i(l=o(l,v),16),d=i(d^=l=o(l,x),17),d=o(d+=h,5)+197830471,f=i(f=o(f,x),17),h=i(h^=f=o(f,C),15),h=o(h+=s,5)+2530024501,p=i(p=o(p,C),18),s=i(s^=p=o(p,A),13),s=o(s+=n,5)+850148119;switch(u=0,l=0,f=0,p=0,r){case 15:p^=e.charCodeAt(y+14)<<16;case 14:p^=e.charCodeAt(y+13)<<8;case 13:p=o(p^=e.charCodeAt(y+12),C),s^=p=o(p=i(p,18),A);case 12:f^=e.charCodeAt(y+11)<<24;case 11:f^=e.charCodeAt(y+10)<<16;case 10:f^=e.charCodeAt(y+9)<<8;case 9:f=o(f^=e.charCodeAt(y+8),x),h^=f=o(f=i(f,17),C);case 8:l^=e.charCodeAt(y+7)<<24;case 7:l^=e.charCodeAt(y+6)<<16;case 6:l^=e.charCodeAt(y+5)<<8;case 5:l=o(l^=e.charCodeAt(y+4),v),d^=l=o(l=i(l,16),x);case 4:u^=e.charCodeAt(y+3)<<24;case 3:u^=e.charCodeAt(y+2)<<16;case 2:u^=e.charCodeAt(y+1)<<8;case 1:u=o(u^=e.charCodeAt(y),A),n^=u=o(u=i(u,15),v)}return n^=e.length,n+=d^=e.length,n+=h^=e.length,d+=n+=s^=e.length,h+=n,s+=n,n=c(n),n+=d=c(d),n+=h=c(h),d+=n+=s=c(s),h+=n,s+=n,("00000000"+(n>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(s>>>0).toString(16)).slice(-8)},n.x64.hash128=function(e,t){t=t||0;for(var r=(e=e||"").length%16,a=e.length-r,n=[0,t],o=[0,t],i=[0,0],c=[0,0],p=[2277735313,289559509],A=[1291169091,658871167],v=0;v<a;v+=16)i=[255&e.charCodeAt(v+4)|(255&e.charCodeAt(v+5))<<8|(255&e.charCodeAt(v+6))<<16|(255&e.charCodeAt(v+7))<<24,255&e.charCodeAt(v)|(255&e.charCodeAt(v+1))<<8|(255&e.charCodeAt(v+2))<<16|(255&e.charCodeAt(v+3))<<24],c=[255&e.charCodeAt(v+12)|(255&e.charCodeAt(v+13))<<8|(255&e.charCodeAt(v+14))<<16|(255&e.charCodeAt(v+15))<<24,255&e.charCodeAt(v+8)|(255&e.charCodeAt(v+9))<<8|(255&e.charCodeAt(v+10))<<16|(255&e.charCodeAt(v+11))<<24],i=s(i=h(i,p),31),n=d(n=s(n=l(n,i=h(i,A)),27),o),n=d(h(n,[0,5]),[0,1390208809]),c=s(c=h(c,A),33),o=d(o=s(o=l(o,c=h(c,p)),31),n),o=d(h(o,[0,5]),[0,944331445]);switch(i=[0,0],c=[0,0],r){case 15:c=l(c,u([0,e.charCodeAt(v+14)],48));case 14:c=l(c,u([0,e.charCodeAt(v+13)],40));case 13:c=l(c,u([0,e.charCodeAt(v+12)],32));case 12:c=l(c,u([0,e.charCodeAt(v+11)],24));case 11:c=l(c,u([0,e.charCodeAt(v+10)],16));case 10:c=l(c,u([0,e.charCodeAt(v+9)],8));case 9:c=h(c=l(c,[0,e.charCodeAt(v+8)]),A),o=l(o,c=h(c=s(c,33),p));case 8:i=l(i,u([0,e.charCodeAt(v+7)],56));case 7:i=l(i,u([0,e.charCodeAt(v+6)],48));case 6:i=l(i,u([0,e.charCodeAt(v+5)],40));case 5:i=l(i,u([0,e.charCodeAt(v+4)],32));case 4:i=l(i,u([0,e.charCodeAt(v+3)],24));case 3:i=l(i,u([0,e.charCodeAt(v+2)],16));case 2:i=l(i,u([0,e.charCodeAt(v+1)],8));case 1:i=h(i=l(i,[0,e.charCodeAt(v)]),p),n=l(n,i=h(i=s(i,31),A))}return n=d(n=l(n,[0,e.length]),o=l(o,[0,e.length])),o=d(o,n),n=d(n=f(n),o=f(o)),o=d(o,n),("00000000"+(n[0]>>>0).toString(16)).slice(-8)+("00000000"+(n[1]>>>0).toString(16)).slice(-8)+("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=n),t.murmurHash3=n}()}(h,h.exports);var s=h.exports;
/*!
   * cookie
   * Copyright(c) 2012-2014 Roman Shtylman
   * Copyright(c) 2015 Douglas Christopher Wilson
   * MIT Licensed
   */
var u=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var r={},a=t||{},n=e.split(A),o=a.decode||f,i=0;i<n.length;i++){var c=n[i],d=c.indexOf("=");if(!(d<0)){var h=c.substr(0,d).trim(),s=c.substr(++d,c.length).trim();'"'==s[0]&&(s=s.slice(1,-1)),null==r[h]&&(r[h]=x(s,o))}}return r},l=function(e,t,r){var a=r||{},n=a.encode||p;if("function"!=typeof n)throw new TypeError("option encode is invalid");if(!v.test(e))throw new TypeError("argument name is invalid");var o=n(t);if(o&&!v.test(o))throw new TypeError("argument val is invalid");var i=e+"="+o;if(null!=a.maxAge){var c=a.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(c)}if(a.domain){if(!v.test(a.domain))throw new TypeError("option domain is invalid");i+="; Domain="+a.domain}if(a.path){if(!v.test(a.path))throw new TypeError("option path is invalid");i+="; Path="+a.path}if(a.expires){if("function"!=typeof a.expires.toUTCString)throw new TypeError("option expires is invalid");i+="; Expires="+a.expires.toUTCString()}a.httpOnly&&(i+="; HttpOnly");a.secure&&(i+="; Secure");if(a.sameSite){switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i},f=decodeURIComponent,p=encodeURIComponent,A=/; */,v=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function x(e,t){try{return t(e)}catch(t){return e}}return function(){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.app_id=e,this.config=r,this.model=c(e,r)}var r,d,h;return r=t,(d=[{key:"getUid",value:function(){return this.uid||u(document.cookie)[n+this.app_id]}},{key:"getTraceId",value:function(){return this.trace_id||u(document.cookie)[o+this.app_id]}},{key:"run",value:function(e){var t=this.getUid()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),r="".concat(t,"_").concat(location.protocol+"://"+location.host+location.path),c=function(e,t,r,n,o){var i={layer:{},trace_id:[]},c=r.layer;for(var d in c)if(!t||d===t){var h=c[d];if(r.launch_layer[d]){var u=r.launch_layer[d],l=u.data,f=u.id,p=u.version;i.layer[d]={hit_exp_data:l,hit_exp_id:f,version:p},i.trace_id.push("".concat(e,"~").concat(d,"~").concat(f,"~").concat(p))}else{var A=s.x86.hash32(n)%a;if(h.ref_exp.bucket.includes(A))i.layer[d]={hit_exp_data:h.ref_exp.data,hit_exp_id:"",version:h.ref_exp.version};else{var v=s.x86.hash32(n+d)%a,x=h.exp_set;for(var C in x)if(x[C].bucket.includes(v)){var y=x[C],g=y.version,m=y.data;i.layer[d]={hit_exp_data:m,hit_exp_id:C,version:g},i.trace_id.push("".concat(e,"_").concat(d,"_").concat(C,"_").concat(g));break}}}}return i.trace_id=i.trace_id.join("|"),i.uid=o,i}(this.app_id,e,this.model,r,t);return function(e,t,r){var a=location.hostname,c=4===a.split(".").length?a:a.replace(/(.+)(?=\..+\..+\b)/,"");document.cookie=l("".concat(n).concat(e),t,{maxAge:i,domain:c}),document.cookie=l("".concat(o).concat(e),r,{maxAge:i,domain:c})}(this.app_id,t,c.trace_id),this.uid=t,this.trace_id=this.trace_id,c}}])&&e(r.prototype,d),h&&e(r,h),t}()}));
