var ABTest=function(){"use strict";const e=100,t="abtest-uid-",r="abtest-trace-id-",a=31536e3,o=e=>{const{hit:t,exp_set:r,layer_id:a,ref_exp_id:o,ref_exp_data:i}=e;if(!a)throw new Error("ABTest配置错误，layer_id 字段不能为空，请检查配置是否正确");if(t<=0||t>1)throw new Error(`${a}实验场景下的 hit 字段取值范围应该为 (0,1]，请检查配置是否正确`);if((t+"").length>4)throw new Error(`${a}实验场景下hit 字段取值范围应该为 (0,1]，且只能精确到小数点后两位，请检查配置是否正确`);if(1!==t&&(void 0===typeof o||void 0===typeof i))throw new Error(`${a}实验场景下 hit 字段取值不为1时，ref_exp_id和ref_exp_data字段不能为空，请检查配置是否正确`);let n=0;for(const e of r){const{id:t,weight:r,data:o}=e;if(!t||!r||!o)throw new Error(`${a}实验场景下 exp_set 字段配置错误，实验id、weight、data字段不能为空，请检查配置是否正确`);if((r+"").length>4)throw new Error(`${a}实验场景下id为${t}权重取值范围应为[0,1]，且只能精确到小数点后两位，请检查配置是否正确`);n+=e.weight}if(n=+n.toFixed(2),n<0||n>1)throw new Error(`${a}实验场景下的 exp_set 权重总和范围应为[0,1]，请检查配置是否正确`);if(t!==n)throw new Error(`${a}实验场景下流量分配错误，hit字段与exp_set权重总和不匹配，请检查配置是否正确`)};function i(t,r){if(!Array.isArray(r))throw new Error("config must be an array");return function(t,r){const a={};a[t]={launch_layer:{},layer:{}};for(let i of r){o(i);let{hit:r,layer_id:c="defaultLayerId",version:h="",exp_set:d,ref_exp_id:s,ref_exp_data:l}=i;a[t].layer[c]={ref_exp:{id:s,data:l,bucket:n(0,(100-100*r)/100*e),version:h},exp_set:{}};let u=(100-100*r)/100*e;for(let r of d){let{id:o,data:i,weight:d}=r,s=Math.round(d*e);if(u+s>e)throw new Error(`ABTest初始化失败，请检查 ${t} 应用中，${c} 场景下的流量分配情况`);let l=n(u,s);a[t].layer[c].exp_set[o]={data:i,bucket:l,version:h},u+=s,1===d&&(a[t].launch_layer[c]={data:i,id:o,version:h})}}return a[t]}(t,r)}function n(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,r=new Array(t),a=e,o=0;for(;t--;)r[o]=a,a++,o++;return r}var c,h,d={exports:{}};c=d,h=d.exports,function(e,t){var r={version:"3.0.1",x86:{},x64:{}};function a(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function o(e,t){return e<<t|e>>>32-t}function i(e){return e=a(e^=e>>>16,2246822507),e=a(e^=e>>>13,3266489909),e^=e>>>16}function n(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function d(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function s(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function l(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function u(e,t){return[e[0]^t[0],e[1]^t[1]]}function f(e){return e=u(e,[0,e[0]>>>1]),e=u(e=d(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=u(e=d(e,[3301882366,444984403]),[0,e[0]>>>1])}r.x86.hash32=function(e,t){t=t||0;for(var r=(e=e||"").length%4,n=e.length-r,c=t,h=0,d=3432918353,s=461845907,l=0;l<n;l+=4)h=a(h=255&e.charCodeAt(l)|(255&e.charCodeAt(l+1))<<8|(255&e.charCodeAt(l+2))<<16|(255&e.charCodeAt(l+3))<<24,d),h=a(h=o(h,15),s),c=a(c=o(c^=h,13),5)+3864292196;switch(h=0,r){case 3:h^=(255&e.charCodeAt(l+2))<<16;case 2:h^=(255&e.charCodeAt(l+1))<<8;case 1:h=a(h^=255&e.charCodeAt(l),d),c^=h=a(h=o(h,15),s)}return(c=i(c^=e.length))>>>0},r.x86.hash128=function(e,t){t=t||0;for(var r=(e=e||"").length%16,n=e.length-r,c=t,h=t,d=t,s=t,l=0,u=0,f=0,x=0,p=597399067,A=2869860233,C=951274213,_=2716044179,g=0;g<n;g+=16)l=255&e.charCodeAt(g)|(255&e.charCodeAt(g+1))<<8|(255&e.charCodeAt(g+2))<<16|(255&e.charCodeAt(g+3))<<24,u=255&e.charCodeAt(g+4)|(255&e.charCodeAt(g+5))<<8|(255&e.charCodeAt(g+6))<<16|(255&e.charCodeAt(g+7))<<24,f=255&e.charCodeAt(g+8)|(255&e.charCodeAt(g+9))<<8|(255&e.charCodeAt(g+10))<<16|(255&e.charCodeAt(g+11))<<24,x=255&e.charCodeAt(g+12)|(255&e.charCodeAt(g+13))<<8|(255&e.charCodeAt(g+14))<<16|(255&e.charCodeAt(g+15))<<24,l=o(l=a(l,p),15),c=o(c^=l=a(l,A),19),c=a(c+=h,5)+1444728091,u=o(u=a(u,A),16),h=o(h^=u=a(u,C),17),h=a(h+=d,5)+197830471,f=o(f=a(f,C),17),d=o(d^=f=a(f,_),15),d=a(d+=s,5)+2530024501,x=o(x=a(x,_),18),s=o(s^=x=a(x,p),13),s=a(s+=c,5)+850148119;switch(l=0,u=0,f=0,x=0,r){case 15:x^=e.charCodeAt(g+14)<<16;case 14:x^=e.charCodeAt(g+13)<<8;case 13:x=a(x^=e.charCodeAt(g+12),_),s^=x=a(x=o(x,18),p);case 12:f^=e.charCodeAt(g+11)<<24;case 11:f^=e.charCodeAt(g+10)<<16;case 10:f^=e.charCodeAt(g+9)<<8;case 9:f=a(f^=e.charCodeAt(g+8),C),d^=f=a(f=o(f,17),_);case 8:u^=e.charCodeAt(g+7)<<24;case 7:u^=e.charCodeAt(g+6)<<16;case 6:u^=e.charCodeAt(g+5)<<8;case 5:u=a(u^=e.charCodeAt(g+4),A),h^=u=a(u=o(u,16),C);case 4:l^=e.charCodeAt(g+3)<<24;case 3:l^=e.charCodeAt(g+2)<<16;case 2:l^=e.charCodeAt(g+1)<<8;case 1:l=a(l^=e.charCodeAt(g),p),c^=l=a(l=o(l,15),A)}return c^=e.length,c+=h^=e.length,c+=d^=e.length,h+=c+=s^=e.length,d+=c,s+=c,c=i(c),c+=h=i(h),c+=d=i(d),h+=c+=s=i(s),d+=c,s+=c,("00000000"+(c>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(s>>>0).toString(16)).slice(-8)},r.x64.hash128=function(e,t){t=t||0;for(var r=(e=e||"").length%16,a=e.length-r,o=[0,t],i=[0,t],c=[0,0],h=[0,0],x=[2277735313,289559509],p=[1291169091,658871167],A=0;A<a;A+=16)c=[255&e.charCodeAt(A+4)|(255&e.charCodeAt(A+5))<<8|(255&e.charCodeAt(A+6))<<16|(255&e.charCodeAt(A+7))<<24,255&e.charCodeAt(A)|(255&e.charCodeAt(A+1))<<8|(255&e.charCodeAt(A+2))<<16|(255&e.charCodeAt(A+3))<<24],h=[255&e.charCodeAt(A+12)|(255&e.charCodeAt(A+13))<<8|(255&e.charCodeAt(A+14))<<16|(255&e.charCodeAt(A+15))<<24,255&e.charCodeAt(A+8)|(255&e.charCodeAt(A+9))<<8|(255&e.charCodeAt(A+10))<<16|(255&e.charCodeAt(A+11))<<24],c=s(c=d(c,x),31),o=n(o=s(o=u(o,c=d(c,p)),27),i),o=n(d(o,[0,5]),[0,1390208809]),h=s(h=d(h,p),33),i=n(i=s(i=u(i,h=d(h,x)),31),o),i=n(d(i,[0,5]),[0,944331445]);switch(c=[0,0],h=[0,0],r){case 15:h=u(h,l([0,e.charCodeAt(A+14)],48));case 14:h=u(h,l([0,e.charCodeAt(A+13)],40));case 13:h=u(h,l([0,e.charCodeAt(A+12)],32));case 12:h=u(h,l([0,e.charCodeAt(A+11)],24));case 11:h=u(h,l([0,e.charCodeAt(A+10)],16));case 10:h=u(h,l([0,e.charCodeAt(A+9)],8));case 9:h=d(h=u(h,[0,e.charCodeAt(A+8)]),p),i=u(i,h=d(h=s(h,33),x));case 8:c=u(c,l([0,e.charCodeAt(A+7)],56));case 7:c=u(c,l([0,e.charCodeAt(A+6)],48));case 6:c=u(c,l([0,e.charCodeAt(A+5)],40));case 5:c=u(c,l([0,e.charCodeAt(A+4)],32));case 4:c=u(c,l([0,e.charCodeAt(A+3)],24));case 3:c=u(c,l([0,e.charCodeAt(A+2)],16));case 2:c=u(c,l([0,e.charCodeAt(A+1)],8));case 1:c=d(c=u(c,[0,e.charCodeAt(A)]),x),o=u(o,c=d(c=s(c,31),p))}return o=n(o=u(o,[0,e.length]),i=u(i,[0,e.length])),i=n(i,o),o=n(o=f(o),i=f(i)),i=n(i,o),("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)+("00000000"+(i[0]>>>0).toString(16)).slice(-8)+("00000000"+(i[1]>>>0).toString(16)).slice(-8)},c.exports&&(h=c.exports=r),h.murmurHash3=r}();var s=d.exports;
/*!
     * cookie
     * Copyright(c) 2012-2014 Roman Shtylman
     * Copyright(c) 2015 Douglas Christopher Wilson
     * MIT Licensed
     */
var l=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var r={},a=t||{},o=e.split(p),i=a.decode||f,n=0;n<o.length;n++){var c=o[n],h=c.indexOf("=");if(!(h<0)){var d=c.substr(0,h).trim(),s=c.substr(++h,c.length).trim();'"'==s[0]&&(s=s.slice(1,-1)),null==r[d]&&(r[d]=C(s,i))}}return r},u=function(e,t,r){var a=r||{},o=a.encode||x;if("function"!=typeof o)throw new TypeError("option encode is invalid");if(!A.test(e))throw new TypeError("argument name is invalid");var i=o(t);if(i&&!A.test(i))throw new TypeError("argument val is invalid");var n=e+"="+i;if(null!=a.maxAge){var c=a.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");n+="; Max-Age="+Math.floor(c)}if(a.domain){if(!A.test(a.domain))throw new TypeError("option domain is invalid");n+="; Domain="+a.domain}if(a.path){if(!A.test(a.path))throw new TypeError("option path is invalid");n+="; Path="+a.path}if(a.expires){if("function"!=typeof a.expires.toUTCString)throw new TypeError("option expires is invalid");n+="; Expires="+a.expires.toUTCString()}a.httpOnly&&(n+="; HttpOnly");a.secure&&(n+="; Secure");if(a.sameSite){switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:n+="; SameSite=Strict";break;case"lax":n+="; SameSite=Lax";break;case"strict":n+="; SameSite=Strict";break;case"none":n+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return n},f=decodeURIComponent,x=encodeURIComponent,p=/; */,A=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function C(e,t){try{return t(e)}catch(t){return e}}return class{constructor(e,t){this.app_id=e,this.config=t,this.model=i(e,t)}getUid(){return this.uid||l(document.cookie)[t+this.app_id]}getTraceId(){return this.trace_id||l(document.cookie)[r+this.app_id]}run(t){let r=this.getUid()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),o=`${r}_${location.protocol+"://"+location.host+location.pathname}`,i=function(t,r,a,o,i){let n={layer:{},trace_id:[]},c=a.layer;for(let i in c){if(r&&i!==r)continue;let h=c[i],d=s.x86.hash32(o)%e;if(h.ref_exp.bucket.includes(d)){const{data:e,id:r,version:a}=h.ref_exp;n.layer[i]={hit_exp_data:e,hit_exp_id:r,version:a},n.trace_id.push(`${t}_${i}_${r}_${a}`)}else{if(a.launch_layer[i]){let{data:e,id:r,version:o}=a.launch_layer[i];n.layer[i]={hit_exp_data:e,hit_exp_id:r,version:o},n.trace_id.push(`${t}_${i}_${r}_${o}`);continue}let r=s.x86.hash32(o+i)%e,c=h.exp_set;for(let e in c)if(c[e].bucket.includes(r)){let{version:r,data:a}=c[e];n.layer[i]={hit_exp_data:a,hit_exp_id:e,version:r},n.trace_id.push(`${t}_${i}_${e}_${r}`);break}}}return n.trace_id=n.trace_id.join("|"),n.uid=i,n}(this.app_id,t,this.model,o,r);return function(e,t,r){let o=location.hostname,i=4===o.split(".").length?o:o.replace(/(.+)(?=\..+\..+\b)/,"");document.cookie=u(`abtest-uid-${e}`,t,{maxAge:a,domain:i}),document.cookie=u(`abtest-trace-id-${e}`,r,{maxAge:a,domain:i})}(this.app_id,r,i.trace_id),this.uid=r,this.trace_id=i.trace_id,i}}}();
