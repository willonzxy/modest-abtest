var ABTest=function(){"use strict";const e=100,t="abtest-uid-",r="abtest-trace-id-",a=31536e3;function o(t,r){if(!Array.isArray(r))throw new Error("config must be an array");return function(t,r){const a={};a[t]={launch_layer:{},layer:{}};for(let o of r){let{hit:r,layer_id:c="defaultLayerId",version:n="",exp_set:h,ref_exp_id:d,ref_exp_data:s}=o;a[t].layer[c]={ref_exp:{id:d,data:s,bucket:i(0,(100-100*r)/100*e),version:n},exp_set:{}};let u=(100-100*r)/100*e;for(let r of h){let{id:o,data:h,weight:d}=r,s=Math.round(d*e);if(u+s>e)throw new Error(`ABTest初始化失败，请检查 ${t} 应用中，${c} 场景下的流量分配情况`);let l=i(u,s);a[t].layer[c].exp_set[o]={data:h,bucket:l,version:n},u+=s,1===d&&(a[t].launch_layer[c]={data:h,id:o,version:n})}}return a[t]}(t,r)}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,r=new Array(t),a=e,o=0;for(;t--;)r[o]=a,a++,o++;return r}var c,n,h={exports:{}};c=h,n=h.exports,function(e,t){var r={version:"3.0.1",x86:{},x64:{}};function a(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function o(e,t){return e<<t|e>>>32-t}function i(e){return e=a(e^=e>>>16,2246822507),e=a(e^=e>>>13,3266489909),e^=e>>>16}function h(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function d(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function s(e,t){return 32==(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function u(e,t){return 0==(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function l(e,t){return[e[0]^t[0],e[1]^t[1]]}function A(e){return e=l(e,[0,e[0]>>>1]),e=l(e=d(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=l(e=d(e,[3301882366,444984403]),[0,e[0]>>>1])}r.x86.hash32=function(e,t){t=t||0;for(var r=(e=e||"").length%4,c=e.length-r,n=t,h=0,d=3432918353,s=461845907,u=0;u<c;u+=4)h=a(h=255&e.charCodeAt(u)|(255&e.charCodeAt(u+1))<<8|(255&e.charCodeAt(u+2))<<16|(255&e.charCodeAt(u+3))<<24,d),h=a(h=o(h,15),s),n=a(n=o(n^=h,13),5)+3864292196;switch(h=0,r){case 3:h^=(255&e.charCodeAt(u+2))<<16;case 2:h^=(255&e.charCodeAt(u+1))<<8;case 1:h=a(h^=255&e.charCodeAt(u),d),n^=h=a(h=o(h,15),s)}return(n=i(n^=e.length))>>>0},r.x86.hash128=function(e,t){t=t||0;for(var r=(e=e||"").length%16,c=e.length-r,n=t,h=t,d=t,s=t,u=0,l=0,A=0,C=0,f=597399067,x=2869860233,p=951274213,_=2716044179,g=0;g<c;g+=16)u=255&e.charCodeAt(g)|(255&e.charCodeAt(g+1))<<8|(255&e.charCodeAt(g+2))<<16|(255&e.charCodeAt(g+3))<<24,l=255&e.charCodeAt(g+4)|(255&e.charCodeAt(g+5))<<8|(255&e.charCodeAt(g+6))<<16|(255&e.charCodeAt(g+7))<<24,A=255&e.charCodeAt(g+8)|(255&e.charCodeAt(g+9))<<8|(255&e.charCodeAt(g+10))<<16|(255&e.charCodeAt(g+11))<<24,C=255&e.charCodeAt(g+12)|(255&e.charCodeAt(g+13))<<8|(255&e.charCodeAt(g+14))<<16|(255&e.charCodeAt(g+15))<<24,u=o(u=a(u,f),15),n=o(n^=u=a(u,x),19),n=a(n+=h,5)+1444728091,l=o(l=a(l,x),16),h=o(h^=l=a(l,p),17),h=a(h+=d,5)+197830471,A=o(A=a(A,p),17),d=o(d^=A=a(A,_),15),d=a(d+=s,5)+2530024501,C=o(C=a(C,_),18),s=o(s^=C=a(C,f),13),s=a(s+=n,5)+850148119;switch(u=0,l=0,A=0,C=0,r){case 15:C^=e.charCodeAt(g+14)<<16;case 14:C^=e.charCodeAt(g+13)<<8;case 13:C=a(C^=e.charCodeAt(g+12),_),s^=C=a(C=o(C,18),f);case 12:A^=e.charCodeAt(g+11)<<24;case 11:A^=e.charCodeAt(g+10)<<16;case 10:A^=e.charCodeAt(g+9)<<8;case 9:A=a(A^=e.charCodeAt(g+8),p),d^=A=a(A=o(A,17),_);case 8:l^=e.charCodeAt(g+7)<<24;case 7:l^=e.charCodeAt(g+6)<<16;case 6:l^=e.charCodeAt(g+5)<<8;case 5:l=a(l^=e.charCodeAt(g+4),x),h^=l=a(l=o(l,16),p);case 4:u^=e.charCodeAt(g+3)<<24;case 3:u^=e.charCodeAt(g+2)<<16;case 2:u^=e.charCodeAt(g+1)<<8;case 1:u=a(u^=e.charCodeAt(g),f),n^=u=a(u=o(u,15),x)}return n^=e.length,n+=h^=e.length,n+=d^=e.length,h+=n+=s^=e.length,d+=n,s+=n,n=i(n),n+=h=i(h),n+=d=i(d),h+=n+=s=i(s),d+=n,s+=n,("00000000"+(n>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(s>>>0).toString(16)).slice(-8)},r.x64.hash128=function(e,t){t=t||0;for(var r=(e=e||"").length%16,a=e.length-r,o=[0,t],i=[0,t],c=[0,0],n=[0,0],C=[2277735313,289559509],f=[1291169091,658871167],x=0;x<a;x+=16)c=[255&e.charCodeAt(x+4)|(255&e.charCodeAt(x+5))<<8|(255&e.charCodeAt(x+6))<<16|(255&e.charCodeAt(x+7))<<24,255&e.charCodeAt(x)|(255&e.charCodeAt(x+1))<<8|(255&e.charCodeAt(x+2))<<16|(255&e.charCodeAt(x+3))<<24],n=[255&e.charCodeAt(x+12)|(255&e.charCodeAt(x+13))<<8|(255&e.charCodeAt(x+14))<<16|(255&e.charCodeAt(x+15))<<24,255&e.charCodeAt(x+8)|(255&e.charCodeAt(x+9))<<8|(255&e.charCodeAt(x+10))<<16|(255&e.charCodeAt(x+11))<<24],c=s(c=d(c,C),31),o=h(o=s(o=l(o,c=d(c,f)),27),i),o=h(d(o,[0,5]),[0,1390208809]),n=s(n=d(n,f),33),i=h(i=s(i=l(i,n=d(n,C)),31),o),i=h(d(i,[0,5]),[0,944331445]);switch(c=[0,0],n=[0,0],r){case 15:n=l(n,u([0,e.charCodeAt(x+14)],48));case 14:n=l(n,u([0,e.charCodeAt(x+13)],40));case 13:n=l(n,u([0,e.charCodeAt(x+12)],32));case 12:n=l(n,u([0,e.charCodeAt(x+11)],24));case 11:n=l(n,u([0,e.charCodeAt(x+10)],16));case 10:n=l(n,u([0,e.charCodeAt(x+9)],8));case 9:n=d(n=l(n,[0,e.charCodeAt(x+8)]),f),i=l(i,n=d(n=s(n,33),C));case 8:c=l(c,u([0,e.charCodeAt(x+7)],56));case 7:c=l(c,u([0,e.charCodeAt(x+6)],48));case 6:c=l(c,u([0,e.charCodeAt(x+5)],40));case 5:c=l(c,u([0,e.charCodeAt(x+4)],32));case 4:c=l(c,u([0,e.charCodeAt(x+3)],24));case 3:c=l(c,u([0,e.charCodeAt(x+2)],16));case 2:c=l(c,u([0,e.charCodeAt(x+1)],8));case 1:c=d(c=l(c,[0,e.charCodeAt(x)]),C),o=l(o,c=d(c=s(c,31),f))}return o=h(o=l(o,[0,e.length]),i=l(i,[0,e.length])),i=h(i,o),o=h(o=A(o),i=A(i)),i=h(i,o),("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)+("00000000"+(i[0]>>>0).toString(16)).slice(-8)+("00000000"+(i[1]>>>0).toString(16)).slice(-8)},c.exports&&(n=c.exports=r),n.murmurHash3=r}();var d=h.exports;
/*!
     * cookie
     * Copyright(c) 2012-2014 Roman Shtylman
     * Copyright(c) 2015 Douglas Christopher Wilson
     * MIT Licensed
     */
var s=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var r={},a=t||{},o=e.split(C),i=a.decode||l,c=0;c<o.length;c++){var n=o[c],h=n.indexOf("=");if(!(h<0)){var d=n.substr(0,h).trim(),s=n.substr(++h,n.length).trim();'"'==s[0]&&(s=s.slice(1,-1)),null==r[d]&&(r[d]=x(s,i))}}return r},u=function(e,t,r){var a=r||{},o=a.encode||A;if("function"!=typeof o)throw new TypeError("option encode is invalid");if(!f.test(e))throw new TypeError("argument name is invalid");var i=o(t);if(i&&!f.test(i))throw new TypeError("argument val is invalid");var c=e+"="+i;if(null!=a.maxAge){var n=a.maxAge-0;if(isNaN(n)||!isFinite(n))throw new TypeError("option maxAge is invalid");c+="; Max-Age="+Math.floor(n)}if(a.domain){if(!f.test(a.domain))throw new TypeError("option domain is invalid");c+="; Domain="+a.domain}if(a.path){if(!f.test(a.path))throw new TypeError("option path is invalid");c+="; Path="+a.path}if(a.expires){if("function"!=typeof a.expires.toUTCString)throw new TypeError("option expires is invalid");c+="; Expires="+a.expires.toUTCString()}a.httpOnly&&(c+="; HttpOnly");a.secure&&(c+="; Secure");if(a.sameSite){switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"strict":c+="; SameSite=Strict";break;case"none":c+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return c},l=decodeURIComponent,A=encodeURIComponent,C=/; */,f=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function x(e,t){try{return t(e)}catch(t){return e}}return class{constructor(e,t){this.app_id=e,this.config=t,this.model=o(e,t)}getUid(){return this.uid||s(document.cookie)[t+this.app_id]}getTraceId(){return this.trace_id||s(document.cookie)[r+this.app_id]}run(t){let r=this.getUid()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),o=`${r}_${location.protocol+"://"+location.host+location.pathname}`,i=function(t,r,a,o,i){let c={layer:{},trace_id:[]},n=a.layer;for(let i in n){if(r&&i!==r)continue;let h=n[i],s=d.x86.hash32(o)%e;if(h.ref_exp.bucket.includes(s)){const{data:e,id:r,version:a}=h.ref_exp;c.layer[i]={hit_exp_data:e,hit_exp_id:r,version:a},c.trace_id.push(`${t}_${i}_${r}_${a}`)}else{if(a.launch_layer[i]){let{data:e,id:r,version:o}=a.launch_layer[i];c.layer[i]={hit_exp_data:e,hit_exp_id:r,version:o},c.trace_id.push(`${t}_${i}_${r}_${o}`);continue}let r=d.x86.hash32(o+i)%e,n=h.exp_set;for(let e in n)if(n[e].bucket.includes(r)){let{version:r,data:a}=n[e];c.layer[i]={hit_exp_data:a,hit_exp_id:e,version:r},c.trace_id.push(`${t}_${i}_${e}_${r}`);break}}}return c.trace_id=c.trace_id.join("|"),c.uid=i,c}(this.app_id,t,this.model,o,r);return function(e,t,r){let o=location.hostname,i=4===o.split(".").length?o:o.replace(/(.+)(?=\..+\..+\b)/,"");document.cookie=u(`abtest-uid-${e}`,t,{maxAge:a,domain:i}),document.cookie=u(`abtest-trace-id-${e}`,r,{maxAge:a,domain:i})}(this.app_id,r,i.trace_id),this.uid=r,this.trace_id=i.trace_id,i}}}();
