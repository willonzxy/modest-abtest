"use strict";function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function r(e,r){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,r){if(e){if("string"==typeof e)return t(e,r);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?t(e,r):void 0}}(e))||r&&e&&"number"==typeof e.length){a&&(e=a);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,i=!0,h=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){h=!0,c=e},f:function(){try{i||null==a.return||a.return()}finally{if(h)throw c}}}}function a(e,t){if(!Array.isArray(t))throw new Error("config must be an array");return function(e,t){var a={};a[e]={launch_layer:{},layer:{}};var o,c=r(t);try{for(c.s();!(o=c.n()).done;){var i=o.value,h=i.hit,d=i.layer_id,s=void 0===d?"defaultLayerId":d,u=i.version,l=void 0===u?"":u,f=i.exp_set,p=i.ref_exp_id,A=i.ref_exp_data;a[e].layer[s]={ref_exp:{id:p,data:A,bucket:n(0,(100-100*h)/100*100),version:l},exp_set:{}};var v,C=(100-100*h)/100*100,x=r(f);try{for(x.s();!(v=x.n()).done;){var y=v.value,g=y.id,m=y.data,_=y.weight,w=Math.round(100*_);if(C+w>100)throw new Error("ABTest初始化失败，请检查 ".concat(e," 应用中，").concat(s," 场景下的流量分配情况"));var b=n(C,w);a[e].layer[s].exp_set[g]={data:m,bucket:b,version:l},C+=w,1===_&&(a[e].launch_layer[s]={data:m,id:g,version:l})}}catch(e){x.e(e)}finally{x.f()}}}catch(e){c.e(e)}finally{c.f()}return a[e]}(e,t)}function n(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,r=new Array(t),a=e,n=0;t--;)r[n]=a,a++,n++;return r}var o={exports:{}};!function(e,t){!function(r,a){var n={version:"3.0.1",x86:{},x64:{}};function o(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function c(e,t){return e<<t|e>>>32-t}function i(e){return e=o(e^=e>>>16,2246822507),e=o(e^=e>>>13,3266489909),e^=e>>>16}function h(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]+t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]+t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]+t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]+t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function d(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var r=[0,0,0,0];return r[3]+=e[3]*t[3],r[2]+=r[3]>>>16,r[3]&=65535,r[2]+=e[2]*t[3],r[1]+=r[2]>>>16,r[2]&=65535,r[2]+=e[3]*t[2],r[1]+=r[2]>>>16,r[2]&=65535,r[1]+=e[1]*t[3],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[2]*t[2],r[0]+=r[1]>>>16,r[1]&=65535,r[1]+=e[3]*t[1],r[0]+=r[1]>>>16,r[1]&=65535,r[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],r[0]&=65535,[r[0]<<16|r[1],r[2]<<16|r[3]]}function s(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function u(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function l(e,t){return[e[0]^t[0],e[1]^t[1]]}function f(e){return e=l(e,[0,e[0]>>>1]),e=l(e=d(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=l(e=d(e,[3301882366,444984403]),[0,e[0]>>>1])}n.x86.hash32=function(e,t){t=t||0;for(var r=(e=e||"").length%4,a=e.length-r,n=t,h=0,d=3432918353,s=461845907,u=0;u<a;u+=4)h=o(h=255&e.charCodeAt(u)|(255&e.charCodeAt(u+1))<<8|(255&e.charCodeAt(u+2))<<16|(255&e.charCodeAt(u+3))<<24,d),h=o(h=c(h,15),s),n=o(n=c(n^=h,13),5)+3864292196;switch(h=0,r){case 3:h^=(255&e.charCodeAt(u+2))<<16;case 2:h^=(255&e.charCodeAt(u+1))<<8;case 1:h=o(h^=255&e.charCodeAt(u),d),n^=h=o(h=c(h,15),s)}return(n=i(n^=e.length))>>>0},n.x86.hash128=function(e,t){t=t||0;for(var r=(e=e||"").length%16,a=e.length-r,n=t,h=t,d=t,s=t,u=0,l=0,f=0,p=0,A=597399067,v=2869860233,C=951274213,x=2716044179,y=0;y<a;y+=16)u=255&e.charCodeAt(y)|(255&e.charCodeAt(y+1))<<8|(255&e.charCodeAt(y+2))<<16|(255&e.charCodeAt(y+3))<<24,l=255&e.charCodeAt(y+4)|(255&e.charCodeAt(y+5))<<8|(255&e.charCodeAt(y+6))<<16|(255&e.charCodeAt(y+7))<<24,f=255&e.charCodeAt(y+8)|(255&e.charCodeAt(y+9))<<8|(255&e.charCodeAt(y+10))<<16|(255&e.charCodeAt(y+11))<<24,p=255&e.charCodeAt(y+12)|(255&e.charCodeAt(y+13))<<8|(255&e.charCodeAt(y+14))<<16|(255&e.charCodeAt(y+15))<<24,u=c(u=o(u,A),15),n=c(n^=u=o(u,v),19),n=o(n+=h,5)+1444728091,l=c(l=o(l,v),16),h=c(h^=l=o(l,C),17),h=o(h+=d,5)+197830471,f=c(f=o(f,C),17),d=c(d^=f=o(f,x),15),d=o(d+=s,5)+2530024501,p=c(p=o(p,x),18),s=c(s^=p=o(p,A),13),s=o(s+=n,5)+850148119;switch(u=0,l=0,f=0,p=0,r){case 15:p^=e.charCodeAt(y+14)<<16;case 14:p^=e.charCodeAt(y+13)<<8;case 13:p=o(p^=e.charCodeAt(y+12),x),s^=p=o(p=c(p,18),A);case 12:f^=e.charCodeAt(y+11)<<24;case 11:f^=e.charCodeAt(y+10)<<16;case 10:f^=e.charCodeAt(y+9)<<8;case 9:f=o(f^=e.charCodeAt(y+8),C),d^=f=o(f=c(f,17),x);case 8:l^=e.charCodeAt(y+7)<<24;case 7:l^=e.charCodeAt(y+6)<<16;case 6:l^=e.charCodeAt(y+5)<<8;case 5:l=o(l^=e.charCodeAt(y+4),v),h^=l=o(l=c(l,16),C);case 4:u^=e.charCodeAt(y+3)<<24;case 3:u^=e.charCodeAt(y+2)<<16;case 2:u^=e.charCodeAt(y+1)<<8;case 1:u=o(u^=e.charCodeAt(y),A),n^=u=o(u=c(u,15),v)}return n^=e.length,n+=h^=e.length,n+=d^=e.length,h+=n+=s^=e.length,d+=n,s+=n,n=i(n),n+=h=i(h),n+=d=i(d),h+=n+=s=i(s),d+=n,s+=n,("00000000"+(n>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(s>>>0).toString(16)).slice(-8)},n.x64.hash128=function(e,t){t=t||0;for(var r=(e=e||"").length%16,a=e.length-r,n=[0,t],o=[0,t],c=[0,0],i=[0,0],p=[2277735313,289559509],A=[1291169091,658871167],v=0;v<a;v+=16)c=[255&e.charCodeAt(v+4)|(255&e.charCodeAt(v+5))<<8|(255&e.charCodeAt(v+6))<<16|(255&e.charCodeAt(v+7))<<24,255&e.charCodeAt(v)|(255&e.charCodeAt(v+1))<<8|(255&e.charCodeAt(v+2))<<16|(255&e.charCodeAt(v+3))<<24],i=[255&e.charCodeAt(v+12)|(255&e.charCodeAt(v+13))<<8|(255&e.charCodeAt(v+14))<<16|(255&e.charCodeAt(v+15))<<24,255&e.charCodeAt(v+8)|(255&e.charCodeAt(v+9))<<8|(255&e.charCodeAt(v+10))<<16|(255&e.charCodeAt(v+11))<<24],c=s(c=d(c,p),31),n=h(n=s(n=l(n,c=d(c,A)),27),o),n=h(d(n,[0,5]),[0,1390208809]),i=s(i=d(i,A),33),o=h(o=s(o=l(o,i=d(i,p)),31),n),o=h(d(o,[0,5]),[0,944331445]);switch(c=[0,0],i=[0,0],r){case 15:i=l(i,u([0,e.charCodeAt(v+14)],48));case 14:i=l(i,u([0,e.charCodeAt(v+13)],40));case 13:i=l(i,u([0,e.charCodeAt(v+12)],32));case 12:i=l(i,u([0,e.charCodeAt(v+11)],24));case 11:i=l(i,u([0,e.charCodeAt(v+10)],16));case 10:i=l(i,u([0,e.charCodeAt(v+9)],8));case 9:i=d(i=l(i,[0,e.charCodeAt(v+8)]),A),o=l(o,i=d(i=s(i,33),p));case 8:c=l(c,u([0,e.charCodeAt(v+7)],56));case 7:c=l(c,u([0,e.charCodeAt(v+6)],48));case 6:c=l(c,u([0,e.charCodeAt(v+5)],40));case 5:c=l(c,u([0,e.charCodeAt(v+4)],32));case 4:c=l(c,u([0,e.charCodeAt(v+3)],24));case 3:c=l(c,u([0,e.charCodeAt(v+2)],16));case 2:c=l(c,u([0,e.charCodeAt(v+1)],8));case 1:c=d(c=l(c,[0,e.charCodeAt(v)]),p),n=l(n,c=d(c=s(c,31),A))}return n=h(n=l(n,[0,e.length]),o=l(o,[0,e.length])),o=h(o,n),n=h(n=f(n),o=f(o)),o=h(o,n),("00000000"+(n[0]>>>0).toString(16)).slice(-8)+("00000000"+(n[1]>>>0).toString(16)).slice(-8)+("00000000"+(o[0]>>>0).toString(16)).slice(-8)+("00000000"+(o[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=n),t.murmurHash3=n}()}(o,o.exports);var c=o.exports;
/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
var i=function(e,t){if("string"!=typeof e)throw new TypeError("argument str must be a string");for(var r={},a=t||{},n=e.split(u),o=a.decode||d,c=0;c<n.length;c++){var i=n[c],h=i.indexOf("=");if(!(h<0)){var s=i.substr(0,h).trim(),l=i.substr(++h,i.length).trim();'"'==l[0]&&(l=l.slice(1,-1)),null==r[s]&&(r[s]=f(l,o))}}return r},h=function(e,t,r){var a=r||{},n=a.encode||s;if("function"!=typeof n)throw new TypeError("option encode is invalid");if(!l.test(e))throw new TypeError("argument name is invalid");var o=n(t);if(o&&!l.test(o))throw new TypeError("argument val is invalid");var c=e+"="+o;if(null!=a.maxAge){var i=a.maxAge-0;if(isNaN(i)||!isFinite(i))throw new TypeError("option maxAge is invalid");c+="; Max-Age="+Math.floor(i)}if(a.domain){if(!l.test(a.domain))throw new TypeError("option domain is invalid");c+="; Domain="+a.domain}if(a.path){if(!l.test(a.path))throw new TypeError("option path is invalid");c+="; Path="+a.path}if(a.expires){if("function"!=typeof a.expires.toUTCString)throw new TypeError("option expires is invalid");c+="; Expires="+a.expires.toUTCString()}a.httpOnly&&(c+="; HttpOnly");a.secure&&(c+="; Secure");if(a.sameSite){switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"strict":c+="; SameSite=Strict";break;case"none":c+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return c},d=decodeURIComponent,s=encodeURIComponent,u=/; */,l=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function f(e,t){try{return t(e)}catch(t){return e}}var p=function(){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.app_id=e,this.config=r,this.model=a(e,r)}var r,n,o;return r=t,(n=[{key:"getUid",value:function(){return this.uid||i(document.cookie)["abtest-uid-"+this.app_id]}},{key:"getTraceId",value:function(){return this.trace_id||i(document.cookie)["abtest-trace-id-"+this.app_id]}},{key:"run",value:function(e){var t=this.getUid()||"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),r="".concat(t,"_").concat(location.protocol+"://"+location.host+location.path),a=function(e,t,r,a,n){var o={layer:{},trace_id:[]},i=r.layer;for(var h in i)if(!t||h===t){var d=i[h],s=c.x86.hash32(a)%100;if(d.ref_exp.bucket.includes(s)){var u=d.ref_exp,l=u.data,f=u.id,p=u.version;o.layer[h]={hit_exp_data:l,hit_exp_id:f,version:p},o.trace_id.push("".concat(e,"_").concat(h,"_").concat(f,"_").concat(p))}else{if(r.launch_layer[h]){var A=r.launch_layer[h],v=A.data,C=A.id,x=A.version;o.layer[h]={hit_exp_data:v,hit_exp_id:C,version:x},o.trace_id.push("".concat(e,"_").concat(h,"_").concat(C,"_").concat(x));continue}var y=c.x86.hash32(a+h)%100,g=d.exp_set;for(var m in g)if(g[m].bucket.includes(y)){var _=g[m],w=_.version,b=_.data;o.layer[h]={hit_exp_data:b,hit_exp_id:m,version:w},o.trace_id.push("".concat(e,"_").concat(h,"_").concat(m,"_").concat(w));break}}}return o.trace_id=o.trace_id.join("|"),o.uid=n,o}(this.app_id,e,this.model,r,t);return function(e,t,r){var a=location.hostname,n=4===a.split(".").length?a:a.replace(/(.+)(?=\..+\..+\b)/,"");document.cookie=h("".concat("abtest-uid-").concat(e),t,{maxAge:31536e3,domain:n}),document.cookie=h("".concat("abtest-trace-id-").concat(e),r,{maxAge:31536e3,domain:n})}(this.app_id,t,a.trace_id),this.uid=t,this.trace_id=this.trace_id,a}}])&&e(r.prototype,n),o&&e(r,o),t}();module.exports=p;
